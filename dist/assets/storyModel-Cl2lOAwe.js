import{p as d,c as g,S as n,g as S}from"./idb-AsxtWpiW.js";import{a as f,b as y}from"./storyApi-CisDlYOj.js";import{S as u}from"./index-BIUkB2tA.js";const i=()=>new Date().toISOString(),A=[{id:"seed-1",name:"Demo 1",description:"Contoh 1",photoUrl:"./public/icons/icon-192.png",lat:-6.2,lon:106.8,createdAt:i()},{id:"seed-2",name:"Demo 2",description:"Contoh 2",photoUrl:"./public/icons/icon-192.png",lat:-6.21,lon:106.82,createdAt:i()},{id:"seed-3",name:"Demo 3",description:"Contoh 3",photoUrl:"./public/icons/icon-192.png",lat:-6.19,lon:106.85,createdAt:i()}];async function w(){const o=await S(n.stories);if(!o||o.length===0)for(const e of A)await d(n.stories,e)}const b={async getCached(){return(await S(n.stories)||[]).map(e=>({...e,createdAt:e.createdAt||i()}))},async listAndCache({page:o=1,size:e=10,location:c=1}={}){const r=u.getToken();if(!r)return await w(),this.getCached();try{const s=(await y({page:o,size:e,location:c},r)||[]).map(t=>({id:t.id,name:t.name,description:t.description,photoUrl:t.photoUrl,lat:t.lat,lon:t.lon,createdAt:t.createdAt||t.created_at||i()}));await g(n.stories);for(const t of s)await d(n.stories,t);return s}catch{return await w(),this.getCached()}},async add({description:o,photo:e,lat:c,lon:r}){var t,p,m;const l=u.getToken();if(l){const a=await f({description:o,photo:e,lat:c,lon:r},l),h={id:((t=a==null?void 0:a.story)==null?void 0:t.id)||`srv-${Date.now()}`,name:((p=a==null?void 0:a.story)==null?void 0:p.name)||"Saya",description:o,photoUrl:((m=a==null?void 0:a.story)==null?void 0:m.photoUrl)||null,lat:c,lon:r,createdAt:i()};return await d(n.stories,h),h}const s={id:`local-${Date.now()}`,name:"Guest",description:o,photo:e,photoUrl:null,lat:c,lon:r,createdAt:i()};return await d(n.stories,s),s}};export{b as S};
